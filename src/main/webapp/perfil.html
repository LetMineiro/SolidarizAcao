<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <title>Perfil do Usuário</title>
        <link rel="stylesheet" href="perfil.css" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    </head>
    <body>
        <!--navbar compartilhada-->
        <div id="navbar-container"></div>
        
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        
        <div class="container">
            
            <section class="perfil-header">
                <i class="bi bi-person-circle icon-perfil"></i>
                <h2 id="nomeUsuario">
                    Olá, Usuário
                </h2>
                <button class="btn-editar" onclick="window.location.href='editar.html'"><i class="bi bi-pencil-square"></i> 
                    Editar Perfil
                </button>
                <button type="button" class="btn-logout" onclick="logout()">
                    <i class="bi bi-box-arrow-right"></i> Sair
                </button>
            </section>
            
            <section class="info-basica">
                <h3><i class="bi bi-info-circle"></i> Informações</h3>
                <ul id="infoUsuario"></ul>
            </section>
            
            <section class="campanhas">
                <h3><i class="bi bi-flag"></i> Campanhas que organizou</h3>
                <ul id="listaCampanhas"></ul>
            </section>
            
            <section class="doacoes">
                <h3><i class="bi bi-box-seam"></i> Suas Doações</h3>
                <ul id="listaDoacoes"></ul>
            </section>
        </div>
        
        <script src="perfil.js"></script>
        
        <!-- Carregamento da navbar compartilhada e ativação do comportamento do menu -->
        <script>
            fetch('nav.html')
                    .then(response => response.text())
                    .then(data => {
                        document.getElementById('navbar-container').innerHTML = data;

                // Interação dos botões da navbar
                $(".sub-btn").click(function () {
                    $(this).next(".sub-menu").slideToggle();
                });

                var menu = document.querySelector(".menu");
                var menuBtn = document.querySelector(".menu-btn");
                var closeBtn = document.querySelector(".close-btn");

                if (menuBtn && closeBtn && menu) {
                    menuBtn.addEventListener("click", () => {
                        menu.classList.add("active");
                    });

                    closeBtn.addEventListener("click", () => {
                        menu.classList.remove("active");
                    });
                }

                window.addEventListener("scroll", function () {
                    var header = document.querySelector("header");
                    if (header) {
                        header.classList.toggle("sticky", window.scrollY > 0);
                    }
                });
        </script>
        <script>
                //Substitui LOGIN pelo nome do usuário se estiver logado
                fetch("perfil")
                        .then(res => res.ok ? res.json() : Promise.reject())
                        .then(data => {
                            const loginLink = document.getElementById("login-link");
                    if (loginLink) {
                        loginLink.textContent = `${data.nome.split(" ")[0].toUpperCase()}`;
                        loginLink.href = "perfil.html";
                    }
                })
                        .catch(() => {
                            // Se não estiver logado, mantém o link para login.html
                    const loginLink = document.getElementById("login-link");
                    if (loginLink) {
                        loginLink.textContent = "LOGIN";
                        loginLink.href = "login.html";
                    }
                });
            });
        </script>
        <script>
            //Encerrar a sessao do usuario
            function logout() {
                fetch("logout", { method: "POST" })
                        .then(res => {
                            if (res.redirected) {
                                window.location.href = res.url;
                    } else {
                        window.location.href = "login.html"; // fallback
                    }
                })
                        .catch(() => {
                            alert("Erro ao sair. Tente novamente.");
                });
            }
        </script>
    </body>
</html>
